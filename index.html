
<!DOCTYPE html>
<html lang="pt-AO">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quinta dos Ovos ERP - Gestão e Vendas</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }

        /* Estilos de Impressão */
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; margin: 0; padding: 0; }
            .print-only { display: block !important; }
            .modal-backdrop { display: none !important; }
            .invoice-container { 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%; 
                box-shadow: none !important; 
                border: none !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            @page { size: auto; margin: 10mm; }
        }

        .modal-backdrop { background-color: rgba(15, 23, 42, 0.8); backdrop-filter: blur(8px); }
        .cart-drawer { transition: transform 0.3s ease-in-out; }
        .cart-drawer.open { transform: translateX(0); }
        .cart-drawer.closed { transform: translateX(100%); }
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.38.0"
  }
}
</script>
</head>
<body class="bg-slate-50 text-slate-900 overflow-x-hidden">

    <!-- HEADER -->
    <header id="main-header" class="sticky top-0 z-[100] bg-white/90 backdrop-blur-md border-b border-amber-100 no-print">
        <div class="max-w-7xl mx-auto px-4 h-20 flex items-center justify-between">
            <div class="flex items-center gap-3 cursor-pointer" id="logo-home">
                <div class="w-12 h-12 bg-amber-600 rounded-2xl flex items-center justify-center text-white shadow-xl shadow-amber-200">
                    <i class="fa-solid fa-egg text-2xl"></i>
                </div>
                <h1 class="text-2xl font-black text-slate-900 leading-none">
                    Quinta<span class="text-amber-600 block text-xs tracking-[0.2em] font-black uppercase">dosOvos</span>
                </h1>
            </div>

            <nav class="hidden md:flex items-center gap-10">
                <a href="#home" class="text-xs font-black uppercase tracking-[0.2em] text-slate-400 hover:text-amber-600 transition-colors">Home</a>
                <a href="#servicos" class="text-xs font-black uppercase tracking-[0.2em] text-slate-400 hover:text-amber-600 transition-colors">Serviços</a>
                <a href="#sobre" class="text-xs font-black uppercase tracking-[0.2em] text-slate-400 hover:text-amber-600 transition-colors">Sobre Nós</a>
            </nav>

            <div class="flex items-center gap-4">
                <button id="cart-toggle" class="relative p-3 bg-slate-50 text-slate-700 rounded-xl hover:bg-amber-50 hover:text-amber-600 transition-all">
                    <i class="fa-solid fa-cart-shopping text-lg"></i>
                    <span id="cart-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-black w-5 h-5 flex items-center justify-center rounded-full ring-2 ring-white">0</span>
                </button>
                <button id="admin-view-toggle" class="hidden bg-slate-900 text-white px-6 py-3 rounded-xl text-xs font-black uppercase tracking-widest shadow-xl">
                    Painel ERP
                </button>
            </div>
        </div>
    </header>

    <!-- VIEW: STORE -->
    <main id="view-store" class="animate-fade-in">
        <!-- Hero Slideshow -->
        <section id="home" class="relative h-[80vh] w-full overflow-hidden bg-slate-900">
            <div id="hero-slides" class="h-full">
                <!-- Slides serão injetados pelo JS -->
            </div>
            <div class="absolute bottom-10 right-10 z-30 flex gap-2" id="hero-dots"></div>
        </section>

        <!-- Serviços -->
        <section id="servicos" class="py-24 bg-white">
            <div class="max-w-7xl mx-auto px-4">
                <div class="text-center mb-16">
                    <span class="text-[10px] font-black uppercase tracking-[0.4em] text-amber-600 block mb-2">Nossas Soluções</span>
                    <h2 class="text-4xl font-black text-slate-900 uppercase tracking-tighter">O que fazemos pela sua granja</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="p-10 rounded-[2.5rem] bg-slate-50 border border-slate-100 hover:border-amber-200 hover:shadow-2xl hover:shadow-amber-100 transition-all group">
                        <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center text-amber-600 text-2xl shadow-sm mb-6 group-hover:bg-amber-600 group-hover:text-white transition-all">
                            <i class="fa-solid fa-vial-circle-check"></i>
                        </div>
                        <h3 class="text-xl font-black text-slate-800 mb-4 uppercase tracking-tighter">Genética Selecionada</h3>
                        <p class="text-slate-500 leading-relaxed text-sm font-medium">Fornecemos pintinhos e ovos férteis com as melhores linhagens para alta produtividade.</p>
                    </div>
                    <div class="p-10 rounded-[2.5rem] bg-slate-50 border border-slate-100 hover:border-amber-200 hover:shadow-2xl hover:shadow-amber-100 transition-all group">
                        <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center text-amber-600 text-2xl shadow-sm mb-6 group-hover:bg-amber-600 group-hover:text-white transition-all">
                            <i class="fa-solid fa-truck-fast"></i>
                        </div>
                        <h3 class="text-xl font-black text-slate-800 mb-4 uppercase tracking-tighter">Logística Técnica</h3>
                        <p class="text-slate-500 leading-relaxed text-sm font-medium">Entrega especializada em todo território nacional, garantindo a integridade dos produtos vivos.</p>
                    </div>
                    <div class="p-10 rounded-[2.5rem] bg-slate-50 border border-slate-100 hover:border-amber-200 hover:shadow-2xl hover:shadow-amber-100 transition-all group">
                        <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center text-amber-600 text-2xl shadow-sm mb-6 group-hover:bg-amber-600 group-hover:text-white transition-all">
                            <i class="fa-solid fa-chalkboard-user"></i>
                        </div>
                        <h3 class="text-xl font-black text-slate-800 mb-4 uppercase tracking-tighter">Consultoria em Manejo</h3>
                        <p class="text-slate-500 leading-relaxed text-sm font-medium">Equipe de técnicos prontos para auxiliar no planejamento e otimização da sua produção.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Loja Online -->
        <section id="loja" class="py-24 bg-slate-50">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex flex-col md:flex-row md:items-end justify-between mb-12 gap-8">
                    <div>
                        <span class="text-[10px] font-black uppercase tracking-[0.4em] text-amber-600 block mb-2">Catálogo Online</span>
                        <h2 class="text-4xl font-black text-slate-900 uppercase tracking-tighter">Adquira Nossos Produtos</h2>
                    </div>
                    <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide" id="category-filters">
                        <!-- Categorias injetadas aqui -->
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8" id="product-grid">
                    <!-- Produtos injetados aqui -->
                </div>
            </div>
        </section>

        <!-- Sobre -->
        <section id="sobre" class="py-24 bg-white overflow-hidden">
            <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row items-center gap-16">
                <div class="flex-1 space-y-8">
                    <span class="text-[10px] font-black uppercase tracking-[0.4em] text-amber-600 block">Nossa História</span>
                    <h2 class="text-5xl font-black text-slate-900 leading-[0.9] uppercase tracking-tighter">Compromisso com o Frescor</h2>
                    <p class="text-slate-600 leading-relaxed font-medium">A Quinta dos Ovos nasceu da paixão pela avicultura sustentável em Angola. Unimos tradição e tecnologia para garantir o melhor rendimento da sua granja.</p>
                </div>
                <div class="flex-1 relative">
                    <img src="https://images.unsplash.com/photo-1590483736622-39da8caf3501?q=80&w=800" class="w-full aspect-square rounded-[3rem] object-cover shadow-2xl rotate-2" alt="Fazenda">
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-slate-900 pt-24 pb-12 text-white">
            <div class="max-w-7xl mx-auto px-4 text-center">
                <div class="flex items-center justify-center gap-3 mb-8">
                    <div class="w-10 h-10 bg-amber-600 rounded-xl flex items-center justify-center text-white">
                        <i class="fa-solid fa-egg"></i>
                    </div>
                    <h2 class="text-xl font-black uppercase tracking-tighter">Quinta dos Ovos</h2>
                </div>
                <p class="text-slate-500 mb-10 max-w-md mx-auto">O parceiro estratégico do avicultor angolano. Tecnologia e qualidade do Huambo para o mundo.</p>
                <button id="btn-open-login" class="px-8 py-4 border border-slate-800 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:border-amber-600 hover:text-amber-600 transition-all">Acesso Administrativo</button>
                <div class="mt-20 pt-10 border-t border-slate-800 text-[10px] text-slate-600 font-black uppercase tracking-[0.5em]">
                    &copy; 2024 Quinta dos Ovos ERP • Made in Angola
                </div>
            </div>
        </footer>
    </main>

    <!-- VIEW: ADMIN ERP -->
    <main id="view-admin" class="hidden animate-fade-in py-8">
        <div class="max-w-7xl mx-auto px-4">
            <div class="bg-white rounded-[2.5rem] shadow-sm border border-slate-100 overflow-hidden min-h-[700px] flex flex-col md:flex-row">
                <!-- Sidebar -->
                <aside class="w-full md:w-72 bg-slate-50 border-r border-slate-100 p-6 flex flex-col gap-2">
                    <div class="mb-8 px-4">
                        <h2 class="text-xs font-black text-slate-400 uppercase tracking-widest">Painel ERP</h2>
                        <p id="admin-user-name" class="text-sm font-bold text-slate-800 truncate">Administrador</p>
                    </div>
                    <nav id="admin-nav" class="space-y-1">
                        <!-- Menus injetados JS -->
                    </nav>
                    <div class="mt-auto pt-6 border-t">
                        <button id="admin-logout" class="w-full flex items-center gap-3 p-4 rounded-2xl font-bold text-sm text-red-400 hover:bg-red-50">
                            <i class="fa-solid fa-right-from-bracket"></i> Sair
                        </button>
                    </div>
                </aside>
                <!-- Main Content Panel -->
                <section id="admin-panel-content" class="flex-1 p-8 md:p-12 overflow-y-auto max-h-[90vh]">
                    <!-- Conteúdo das abas injetado aqui -->
                </section>
            </div>
        </div>
    </main>

    <!-- MODAL: LOGIN -->
    <div id="modal-login" class="hidden fixed inset-0 z-[200] modal-backdrop flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-md rounded-[2.5rem] shadow-2xl overflow-hidden animate-fade-in">
            <div class="bg-slate-900 p-8 text-white text-center">
                <i class="fa-solid fa-shield-halved text-4xl mb-4 text-amber-500"></i>
                <h2 class="text-2xl font-bold">Acesso Restrito</h2>
                <p class="text-slate-400 text-sm mt-1">Identifique-se para continuar</p>
            </div>
            <form id="form-login" class="p-8 space-y-4">
                <input type="text" id="login-user" placeholder="Usuário" required class="w-full bg-slate-50 p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-amber-500">
                <input type="password" id="login-pass" placeholder="Senha" required class="w-full bg-slate-50 p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-amber-500">
                <button type="submit" class="w-full bg-amber-600 text-white py-4 rounded-2xl font-black uppercase tracking-widest shadow-xl">Entrar</button>
                <button type="button" class="btn-close-modal w-full text-slate-400 text-xs font-bold py-2">Voltar</button>
            </form>
        </div>
    </div>

    <!-- MODAL: INVOICE (FATURA) -->
    <div id="modal-invoice" class="hidden fixed inset-0 z-[300] modal-backdrop flex items-center justify-center p-4 print:static print:block print:p-0">
        <div class="bg-white w-full max-w-3xl rounded-[2.5rem] shadow-2xl overflow-hidden animate-fade-in flex flex-col max-h-[90vh] print:max-h-none print:shadow-none print:w-full print:rounded-none invoice-container">
            <div class="p-10 overflow-y-auto flex-1 bg-white print:p-0 print:overflow-visible" id="invoice-content">
                <!-- Conteúdo da fatura injetado aqui -->
            </div>
            <div class="bg-slate-50 p-8 flex gap-4 no-print border-t">
                <button id="btn-print-invoice" class="flex-1 bg-slate-900 text-white font-black py-4 rounded-2xl flex items-center justify-center gap-2">
                    <i class="fa-solid fa-print"></i> Imprimir Fatura
                </button>
                <button class="btn-close-modal px-10 py-4 text-slate-500 font-black">Fechar</button>
            </div>
        </div>
    </div>

    <!-- CART DRAWER -->
    <div id="cart-drawer-backdrop" class="hidden fixed inset-0 z-[150] bg-black/40 backdrop-blur-sm"></div>
    <div id="cart-drawer" class="fixed top-0 right-0 h-full w-full max-w-md bg-white shadow-2xl z-[160] cart-drawer closed flex flex-col no-print">
        <div class="p-6 border-b flex items-center justify-between">
            <h2 class="text-xl font-bold flex items-center gap-2 text-slate-800">
                <i class="fa-solid fa-shopping-basket text-amber-600"></i> Seu Carrinho
            </h2>
            <button id="cart-close" class="text-slate-400 hover:text-slate-600"><i class="fa-solid fa-xmark text-xl"></i></button>
        </div>
        <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-6">
            <!-- Itens do carrinho -->
        </div>
        <div class="p-6 border-t bg-slate-50 space-y-4">
            <div class="flex justify-between items-center">
                <span class="text-slate-500 font-medium">Total</span>
                <span id="cart-total" class="text-2xl font-bold text-slate-900">Kz 0,00</span>
            </div>
            <button id="btn-checkout" class="w-full bg-amber-600 text-white py-4 rounded-2xl font-black uppercase tracking-widest shadow-lg shadow-amber-200">Finalizar Pedido</button>
        </div>
    </div>

    <!-- AI ASSISTANT -->
    <div id="ai-assistant-container" class="fixed bottom-6 left-6 z-[90] no-print">
        <button id="ai-toggle" class="w-14 h-14 bg-indigo-600 rounded-full flex items-center justify-center text-white shadow-2xl hover:scale-110 transition-all">
            <i class="fa-solid fa-robot text-xl"></i>
        </button>
        <div id="ai-chat" class="hidden absolute bottom-20 left-0 w-[350px] md:w-[400px] h-[500px] bg-white rounded-3xl shadow-2xl border flex flex-col overflow-hidden animate-fade-in">
            <div class="bg-indigo-600 p-4 text-white flex items-center gap-3">
                <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center"><i class="fa-solid fa-robot"></i></div>
                <div><h3 class="font-bold text-sm">Assistente Avícola</h3><span class="text-[10px] opacity-70">Quinta dos Ovos AI</span></div>
            </div>
            <div id="ai-messages" class="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50"></div>
            <div class="p-4 border-t bg-white flex gap-2">
                <input type="text" id="ai-input" placeholder="Pergunte sobre manejo ou ração..." class="flex-1 bg-slate-100 rounded-xl px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500">
                <button id="ai-send" class="bg-indigo-600 text-white w-10 h-10 rounded-xl flex items-center justify-center"><i class="fa-solid fa-paper-plane text-xs"></i></button>
            </div>
        </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="hidden fixed bottom-6 right-6 z-[400] bg-slate-900 text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-3 animate-fade-in">
        <div class="w-6 h-6 bg-emerald-500 rounded-full flex items-center justify-center text-[10px]"><i class="fa-solid fa-check"></i></div>
        <span id="toast-message" class="text-sm font-medium">Operação realizada!</span>
    </div>

    <!-- LOGIC (ESM) -->
    <script type="module">
        import { GoogleGenAI } from "@google/genai";

        // --- STATE ---
        let products = JSON.parse(localStorage.getItem('erp_products')) || [
            { id: 1, name: "Incubadora Digital 54", price: 850000, category: "Incubação", stock: 12, cost: 600000, image: "https://images.unsplash.com/photo-1594488358434-738980327f1c?q=80&w=400", rating: 4.9 },
            { id: 2, name: "Ração Postura Premium", price: 115000, category: "Rações", stock: 50, cost: 80000, image: "https://images.unsplash.com/photo-1516467508483-a7212febe31a?q=80&w=400", rating: 4.8 },
            { id: 3, name: "Bebedouro Automático", price: 89000, category: "Equipamentos", stock: 30, cost: 50000, image: "https://images.unsplash.com/photo-1589923188900-85dae523342b?q=80&w=400", rating: 4.7 }
        ];

        let employees = JSON.parse(localStorage.getItem('erp_employees')) || [
            { id: 1, name: "Carlos Silva", role: "Técnico de Campo", salary: 280000, status: "PAGO" }
        ];

        let transactions = JSON.parse(localStorage.getItem('erp_transactions')) || [];
        let cart = [];
        let currentView = 'store';
        let isAdminLoggedIn = false;
        let activeAdminTab = 'dashboard';

        const HERO_SLIDES = [
            { url: "https://images.unsplash.com/photo-1500382017468-9049fed747ef?q=80&w=1200", title: "Nossa Fazenda", subtitle: "Tradição e tecnologia no coração de Angola" },
            { url: "https://images.unsplash.com/photo-1516467508483-a7212febe31a?q=80&w=1200", title: "Genética Premium", subtitle: "Pintinhos selecionados para alto rendimento" }
        ];

        // --- UI HELPERS ---
        const formatKz = (v) => v.toLocaleString('pt-AO', { style: 'currency', currency: 'AOA' }).replace('AOA', 'Kz');
        
        const showToast = (msg) => {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').innerText = msg;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        };

        // --- RENDER FUNCTIONS ---
        const renderStore = (filter = 'Todos') => {
            const grid = document.getElementById('product-grid');
            grid.innerHTML = '';
            
            const filtered = filter === 'Todos' ? products : products.filter(p => p.category === filter);
            
            filtered.forEach(p => {
                grid.innerHTML += `
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden group hover:shadow-xl transition-all">
                        <div class="relative aspect-square overflow-hidden bg-slate-100">
                            <img src="${p.image}" class="w-full h-full object-cover group-hover:scale-105 transition-all">
                            <div class="absolute top-3 right-3 bg-white/90 px-2 py-1 rounded-lg text-[10px] font-black shadow-sm">★ ${p.rating}</div>
                        </div>
                        <div class="p-5">
                            <span class="text-[10px] font-black text-amber-600 uppercase mb-1 block">${p.category}</span>
                            <h3 class="text-sm font-bold text-slate-800 mb-4">${p.name}</h3>
                            <div class="flex items-center justify-between">
                                <span class="text-lg font-black">${formatKz(p.price)}</span>
                                <button onclick="addToCart(${p.id})" class="bg-amber-600 text-white p-3 rounded-xl active:scale-95 transition-all">
                                    <i class="fa-solid fa-cart-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });

            // Categorias
            const cats = ['Todos', ...new Set(products.map(p => p.category))];
            const filterContainer = document.getElementById('category-filters');
            filterContainer.innerHTML = cats.map(c => `
                <button onclick="renderStore('${c}')" class="px-6 py-3 rounded-full text-[10px] font-black uppercase tracking-widest whitespace-nowrap transition-all ${filter === c ? 'bg-amber-600 text-white' : 'bg-white text-slate-400'}">${c}</button>
            `).join('');
        };

        const renderCart = () => {
            const container = document.getElementById('cart-items');
            const badge = document.getElementById('cart-badge');
            const totalEl = document.getElementById('cart-total');
            
            container.innerHTML = '';
            let total = 0;
            let count = 0;

            cart.forEach(item => {
                total += item.price * item.quantity;
                count += item.quantity;
                container.innerHTML += `
                    <div class="flex gap-4 items-center">
                        <img src="${item.image}" class="w-16 h-16 rounded-xl object-cover">
                        <div class="flex-1">
                            <h4 class="text-xs font-bold">${item.name}</h4>
                            <p class="text-[10px] text-amber-600 font-black">${formatKz(item.price)}</p>
                        </div>
                        <div class="flex items-center border rounded-lg overflow-hidden text-xs">
                            <button onclick="updateCartQty(${item.id}, -1)" class="px-2 py-1 bg-slate-50">-</button>
                            <span class="px-3 py-1 font-black">${item.quantity}</span>
                            <button onclick="updateCartQty(${item.id}, 1)" class="px-2 py-1 bg-slate-50">+</button>
                        </div>
                    </div>
                `;
            });

            badge.innerText = count;
            badge.classList.toggle('hidden', count === 0);
            totalEl.innerText = formatKz(total);
        };

        const renderAdmin = () => {
            const content = document.getElementById('admin-panel-content');
            const nav = document.getElementById('admin-nav');
            
            const menu = [
                { id: 'dashboard', label: 'Dashboard', icon: 'fa-gauge' },
                { id: 'caixa', label: 'Caixa (POS)', icon: 'fa-cash-register' },
                { id: 'stock', label: 'Inventário', icon: 'fa-boxes-stacked' },
                { id: 'rh', label: 'RH', icon: 'fa-users-gear' }
            ];

            nav.innerHTML = menu.map(m => `
                <button onclick="switchAdminTab('${m.id}')" class="w-full flex items-center gap-3 p-4 rounded-2xl font-bold text-sm transition-all ${activeAdminTab === m.id ? 'bg-amber-600 text-white' : 'text-slate-500 hover:bg-white'}">
                    <i class="fa-solid ${m.icon}"></i> ${m.label}
                </button>
            `).join('');

            if (activeAdminTab === 'dashboard') {
                const totalIn = transactions.reduce((a, t) => t.type === 'ENTRADA' ? a + t.amount : a, 0);
                const totalOut = transactions.reduce((a, t) => t.type === 'SAIDA' ? a + t.amount : a, 0);
                content.innerHTML = `
                    <div class="space-y-8 animate-fade-in">
                        <h2 class="text-3xl font-black uppercase tracking-tighter">Resumo Financeiro</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="p-8 bg-emerald-50 rounded-[2.5rem] border border-emerald-100">
                                <span class="text-[10px] font-black uppercase text-emerald-600">Total Receitas</span>
                                <div class="text-3xl font-black text-emerald-700 mt-2">${formatKz(totalIn)}</div>
                            </div>
                            <div class="p-8 bg-red-50 rounded-[2.5rem] border border-red-100">
                                <span class="text-[10px] font-black uppercase text-red-600">Total Despesas</span>
                                <div class="text-3xl font-black text-red-700 mt-2">${formatKz(totalOut)}</div>
                            </div>
                            <div class="p-8 bg-slate-900 rounded-[2.5rem] text-white">
                                <span class="text-[10px] font-black uppercase text-slate-400">Saldo Caixa</span>
                                <div class="text-3xl font-black mt-2 text-amber-500">${formatKz(totalIn - totalOut)}</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (activeAdminTab === 'caixa') {
                content.innerHTML = `
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 h-full animate-fade-in">
                        <div class="lg:col-span-2 space-y-6">
                            <h2 class="text-2xl font-black uppercase">Ponto de Venda (POS)</h2>
                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-4" id="pos-grid"></div>
                        </div>
                        <div class="bg-slate-900 rounded-[2.5rem] p-8 text-white flex flex-col">
                            <h3 class="font-black uppercase mb-8">Venda em Curso</h3>
                            <div id="pos-cart" class="flex-1 space-y-4 overflow-y-auto"></div>
                            <div class="mt-8 pt-8 border-t border-slate-800 space-y-4">
                                <div class="flex justify-between font-black text-xl"><span>Total</span><span id="pos-total">Kz 0,00</span></div>
                                <button onclick="checkoutPOS()" class="w-full bg-amber-600 py-4 rounded-2xl font-black uppercase shadow-xl">Fechar Venda</button>
                            </div>
                        </div>
                    </div>
                `;
                renderPOSGrid();
            } else if (activeAdminTab === 'stock') {
                content.innerHTML = `
                    <div class="space-y-8 animate-fade-in">
                        <div class="flex justify-between items-center">
                            <h2 class="text-2xl font-black uppercase">Gestão de Estoque</h2>
                            <button onclick="alert('Funcionalidade de adição em desenvolvimento')" class="bg-amber-600 text-white px-6 py-3 rounded-2xl font-black text-xs uppercase">Novo Produto</button>
                        </div>
                        <div class="bg-white rounded-3xl border border-slate-100 overflow-hidden shadow-sm">
                            <table class="w-full text-left">
                                <thead class="bg-slate-50 text-[10px] uppercase font-black text-slate-400">
                                    <tr><th class="p-6">Artigo</th><th class="p-6">Estoque</th><th class="p-6">P. Venda</th></tr>
                                </thead>
                                <tbody class="divide-y divide-slate-100">
                                    ${products.map(p => `<tr><td class="p-6 font-bold">${p.name}</td><td class="p-6"><span class="px-3 py-1 bg-slate-100 rounded-lg text-[10px] font-black">${p.stock} UN</span></td><td class="p-6">${formatKz(p.price)}</td></tr>`).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } else if (activeAdminTab === 'rh') {
                 content.innerHTML = `
                    <div class="space-y-8 animate-fade-in">
                        <h2 class="text-2xl font-black uppercase">Recursos Humanos</h2>
                        <div class="grid grid-cols-1 gap-4">
                            ${employees.map(e => `
                                <div class="bg-white p-6 rounded-[2rem] border flex justify-between items-center group">
                                    <div class="flex items-center gap-4">
                                        <div class="w-12 h-12 bg-slate-100 rounded-xl flex items-center justify-center text-slate-400"><i class="fa-solid fa-user"></i></div>
                                        <div>
                                            <div class="font-black text-slate-800">${e.name}</div>
                                            <div class="text-[10px] text-amber-600 font-bold uppercase">${e.role}</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <div class="text-sm font-bold">${formatKz(e.salary)}</div>
                                        <button onclick="alert('Salário Pago!')" class="bg-emerald-500 text-white px-4 py-2 rounded-xl text-[10px] font-black uppercase">Pagar</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                 `;
            }
        };

        const renderPOSGrid = () => {
            const grid = document.getElementById('pos-grid');
            if(!grid) return;
            grid.innerHTML = products.map(p => `
                <button onclick="addToCartPOS(${p.id})" class="bg-white p-4 rounded-[2rem] border hover:border-amber-500 text-left space-y-2 transition-all group">
                    <img src="${p.image}" class="w-full aspect-square object-cover rounded-xl mb-2 group-hover:scale-105 transition-all">
                    <div class="text-[10px] font-black uppercase text-slate-400">${p.category}</div>
                    <div class="text-xs font-bold truncate">${p.name}</div>
                    <div class="text-xs font-black text-amber-600">${formatKz(p.price)}</div>
                </button>
            `).join('');
        };

        // --- ACTIONS ---
        window.addToCart = (id) => {
            const prod = products.find(p => p.id === id);
            const inCart = cart.find(i => i.id === id);
            if (inCart) inCart.quantity++;
            else cart.push({ ...prod, quantity: 1 });
            renderCart();
            showToast(`${prod.name} adicionado!`);
        };

        window.updateCartQty = (id, delta) => {
            const item = cart.find(i => i.id === id);
            item.quantity += delta;
            if (item.quantity <= 0) cart = cart.filter(i => i.id !== id);
            renderCart();
        };

        let posCartLocal = [];
        window.addToCartPOS = (id) => {
            const prod = products.find(p => p.id === id);
            const inCart = posCartLocal.find(i => i.id === id);
            if(inCart) inCart.quantity++;
            else posCartLocal.push({ ...prod, quantity: 1 });
            renderPOSCart();
        };

        const renderPOSCart = () => {
            const container = document.getElementById('pos-cart');
            const totalEl = document.getElementById('pos-total');
            let total = 0;
            container.innerHTML = posCartLocal.map(item => {
                total += item.price * item.quantity;
                return `
                    <div class="flex justify-between items-center text-xs">
                        <div class="flex-1 truncate pr-2">${item.name}</div>
                        <div class="font-black text-amber-500">x${item.quantity}</div>
                    </div>
                `;
            }).join('');
            totalEl.innerText = formatKz(total);
        };

        window.checkoutPOS = () => {
            if (posCartLocal.length === 0) return;
            const total = posCartLocal.reduce((a, i) => a + (i.price * i.quantity), 0);
            
            // Gravar transação
            transactions.push({
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                type: 'ENTRADA',
                amount: total,
                items: [...posCartLocal]
            });
            localStorage.setItem('erp_transactions', JSON.stringify(transactions));
            
            // Gerar Fatura
            showInvoiceModal({
                id: Math.floor(Math.random() * 99999),
                date: new Date().toLocaleString(),
                items: [...posCartLocal],
                total
            });
            
            posCartLocal = [];
            renderPOSCart();
            showToast("Venda realizada com sucesso!");
        };

        const showInvoiceModal = (invoice) => {
            const modal = document.getElementById('modal-invoice');
            const content = document.getElementById('invoice-content');
            
            content.innerHTML = `
                <div class="border-b-4 border-amber-600 pb-8 mb-10 flex justify-between items-start">
                    <div>
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-10 h-10 bg-amber-600 rounded-xl flex items-center justify-center text-white"><i class="fa-solid fa-egg"></i></div>
                            <h1 class="text-3xl font-black tracking-tighter">QUINTA DOS OVOS</h1>
                        </div>
                        <div class="text-[10px] text-slate-500 uppercase font-black space-y-1">
                            <p>Huambo, Angola</p>
                            <p>Contribuinte: 5001234567</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="bg-slate-900 text-white px-4 py-2 rounded-lg text-xs font-black uppercase mb-2">FATURA / RECIBO</div>
                        <p class="font-black text-sm">Nº ${invoice.id}</p>
                        <p class="text-[10px] text-slate-500">${invoice.date}</p>
                    </div>
                </div>
                <table class="w-full text-left mb-10">
                    <thead class="bg-slate-50 text-[10px] font-black uppercase text-slate-400">
                        <tr><th class="p-4">Artigo</th><th class="p-4 text-center">Unit.</th><th class="p-4 text-center">Qtd</th><th class="p-4 text-right">Total</th></tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100">
                        ${invoice.items.map(item => `
                            <tr class="text-xs">
                                <td class="p-4 font-bold">${item.name}</td>
                                <td class="p-4 text-center">${formatKz(item.price)}</td>
                                <td class="p-4 text-center font-black">${item.quantity}</td>
                                <td class="p-4 text-right font-black">${formatKz(item.price * item.quantity)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <div class="flex flex-col items-end border-t pt-8">
                    <div class="w-full max-w-xs space-y-2">
                        <div class="flex justify-between text-[10px] font-black text-slate-400"><span>SUBTOTAL</span><span>${formatKz(invoice.total)}</span></div>
                        <div class="flex justify-between text-2xl font-black pt-4 border-t"><span>TOTAL</span><span class="text-amber-600">${formatKz(invoice.total)}</span></div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        };

        // --- NAVIGATION ---
        window.switchAdminTab = (id) => {
            activeAdminTab = id;
            renderAdmin();
        };

        const switchView = (v) => {
            currentView = v;
            document.getElementById('view-store').classList.toggle('hidden', v !== 'store');
            document.getElementById('view-admin').classList.toggle('hidden', v !== 'admin');
            document.getElementById('admin-view-toggle').classList.toggle('hidden', !isAdminLoggedIn);
            document.getElementById('admin-view-toggle').innerText = v === 'admin' ? 'Voltar para Loja' : 'Painel ERP';
        };

        // --- EVENT LISTENERS ---
        document.getElementById('admin-view-toggle').addEventListener('click', () => {
            switchView(currentView === 'store' ? 'admin' : 'store');
            if(currentView === 'admin') renderAdmin();
        });

        document.getElementById('btn-open-login').addEventListener('click', () => {
            document.getElementById('modal-login').classList.remove('hidden');
        });

        document.querySelectorAll('.btn-close-modal').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('modal-login').classList.add('hidden');
                document.getElementById('modal-invoice').classList.add('hidden');
            });
        });

        document.getElementById('form-login').addEventListener('submit', (e) => {
            e.preventDefault();
            const u = document.getElementById('login-user').value;
            const p = document.getElementById('login-pass').value;
            if(u === 'admin' && p === '123') {
                isAdminLoggedIn = true;
                document.getElementById('modal-login').classList.add('hidden');
                switchView('admin');
                renderAdmin();
                showToast("Bem-vindo, Administrador!");
            } else {
                alert("Credenciais Inválidas!");
            }
        });

        document.getElementById('admin-logout').addEventListener('click', () => {
            isAdminLoggedIn = false;
            switchView('store');
        });

        document.getElementById('cart-toggle').addEventListener('click', () => {
            document.getElementById('cart-drawer').classList.replace('closed', 'open');
            document.getElementById('cart-drawer-backdrop').classList.remove('hidden');
        });

        document.getElementById('cart-close').addEventListener('click', () => {
            document.getElementById('cart-drawer').classList.replace('open', 'closed');
            document.getElementById('cart-drawer-backdrop').classList.add('hidden');
        });

        document.getElementById('btn-checkout').addEventListener('click', () => {
            if(cart.length === 0) return;
            const total = cart.reduce((a, i) => a + (i.price * i.quantity), 0);
            
            transactions.push({
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                type: 'ENTRADA',
                amount: total,
                items: [...cart]
            });
            localStorage.setItem('erp_transactions', JSON.stringify(transactions));
            
            showInvoiceModal({
                id: Math.floor(Math.random() * 99999),
                date: new Date().toLocaleString(),
                items: [...cart],
                total
            });
            
            cart = [];
            renderCart();
            document.getElementById('cart-close').click();
        });

        document.getElementById('btn-print-invoice').addEventListener('click', () => window.print());

        document.getElementById('logo-home').addEventListener('click', () => switchView('store'));

        // --- AI ASSISTANT ---
        const aiToggle = document.getElementById('ai-toggle');
        const aiChat = document.getElementById('ai-chat');
        const aiMessages = document.getElementById('ai-messages');
        const aiInput = document.getElementById('ai-input');
        const aiSend = document.getElementById('ai-send');

        aiToggle.addEventListener('click', () => aiChat.classList.toggle('hidden'));

        const addAIMessage = (role, text) => {
            const div = document.createElement('div');
            div.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            div.innerHTML = `
                <div class="max-w-[85%] px-4 py-2 rounded-2xl text-[11px] font-medium ${role === 'user' ? 'bg-indigo-600 text-white rounded-tr-none' : 'bg-white border text-slate-700 rounded-tl-none shadow-sm'}">
                    ${text}
                </div>
            `;
            aiMessages.appendChild(div);
            aiMessages.scrollTop = aiMessages.scrollHeight;
        };

        const handleAISend = async () => {
            const text = aiInput.value.trim();
            if(!text) return;
            
            addAIMessage('user', text);
            aiInput.value = '';
            
            try {
                const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                const response = await ai.models.generateContent({
                    model: 'gemini-3-flash-preview',
                    contents: text,
                    config: {
                        systemInstruction: `Você é o assistente virtual da Quinta dos Ovos, Angola. 
                        Produtos: ${products.map(p => p.name).join(', ')}. 
                        Sempre use Kwanzas (Kz). Seja prestativo e profissional.`
                    }
                });
                addAIMessage('model', response.text);
            } catch (err) {
                addAIMessage('model', "Tive um problema de conexão. Como posso ajudar com sua produção?");
            }
        };

        aiSend.addEventListener('click', handleAISend);
        aiInput.addEventListener('keypress', (e) => e.key === 'Enter' && handleAISend());

        // --- INITIALIZATION ---
        const initHero = () => {
            const container = document.getElementById('hero-slides');
            const dots = document.getElementById('hero-dots');
            HERO_SLIDES.forEach((slide, i) => {
                const div = document.createElement('div');
                div.className = `absolute inset-0 transition-opacity duration-1000 slide ${i === 0 ? 'opacity-100' : 'opacity-0'}`;
                div.innerHTML = `
                    <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent to-slate-900/40 z-10"></div>
                    <img src="${slide.url}" class="w-full h-full object-cover">
                    <div class="absolute bottom-20 left-10 md:left-24 z-20 max-w-2xl text-white animate-fade-in">
                        <h2 class="text-4xl md:text-6xl font-black uppercase tracking-tighter mb-4 leading-none">${slide.title}</h2>
                        <p class="text-lg opacity-80">${slide.subtitle}</p>
                        <a href="#loja" class="mt-8 inline-block bg-amber-600 px-10 py-5 rounded-2xl font-black uppercase tracking-widest shadow-2xl active:scale-95 transition-all">Explorar</a>
                    </div>
                `;
                container.appendChild(div);
                
                const dot = document.createElement('button');
                dot.className = `h-1.5 rounded-full transition-all ${i === 0 ? 'w-10 bg-amber-600' : 'w-4 bg-white/30'}`;
                dots.appendChild(dot);
            });

            let current = 0;
            setInterval(() => {
                const slides = document.querySelectorAll('.slide');
                const dotBtns = dots.querySelectorAll('button');
                slides[current].classList.replace('opacity-100', 'opacity-0');
                dotBtns[current].classList.replace('w-10', 'w-4');
                dotBtns[current].classList.replace('bg-amber-600', 'bg-white/30');
                
                current = (current + 1) % slides.length;
                
                slides[current].classList.replace('opacity-0', 'opacity-100');
                dotBtns[current].classList.replace('w-4', 'w-10');
                dotBtns[current].classList.replace('bg-white/30', 'bg-amber-600');
            }, 6000);
        };

        // RUN
        initHero();
        renderStore();
        renderCart();
        addAIMessage('model', "Olá! Sou o assistente da Quinta dos Ovos. Como posso ajudar na sua produção avícola hoje?");
    </script>
</body>
</html>
